<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ExactaBetting.App.ViewModels"
             x:Class="ExactaBetting.App.MainPage"
             x:DataType="vm:MainViewModel"
             Title="Tote Value Bets">

    <Grid RowDefinitions="Auto" Padding="20" RowSpacing="16">
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Spacing="16">

            <!-- Settings Card -->
            <Frame BorderColor="{StaticResource Primary}"
                   CornerRadius="8"
                   Padding="16"
                   HasShadow="True">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Settings" FontAttributes="Bold" FontSize="18" />
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="8">
                        <Label Grid.Row="0" Grid.Column="0" Text="Value threshold (%)" VerticalOptions="Center" />
                        <Entry Grid.Row="0" Grid.Column="1"
                               Text="{Binding ValueThresholdPercent, Mode=TwoWay}"
                               Keyboard="Numeric" Placeholder="10" />

                        <Label Grid.Row="1" Grid.Column="0" Text="Min pool size" VerticalOptions="Center" />
                        <Entry Grid.Row="1" Grid.Column="1"
                               Text="{Binding MinimumPoolSize, Mode=TwoWay}"
                               Keyboard="Numeric" Placeholder="5000" />

                        <Label Grid.Row="2" Grid.Column="0" Text="Stake (dilution calc)" VerticalOptions="Center" />
                        <Entry Grid.Row="2" Grid.Column="1"
                               Text="{Binding DefaultStake, Mode=TwoWay}"
                               Keyboard="Numeric" Placeholder="100" />

                        <Label Grid.Row="3" Grid.Column="0" Text="Top bets to show" VerticalOptions="Center" />
                        <Entry Grid.Row="3" Grid.Column="1"
                               Text="{Binding TopBetCount, Mode=TwoWay}"
                               Keyboard="Numeric" Placeholder="5" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Race Selection -->
            <Frame BorderColor="{StaticResource Primary}"
                   CornerRadius="8"
                   Padding="16"
                   HasShadow="True">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Race" FontAttributes="Bold" FontSize="18" />
                        <Button Text="Load Races"
                            Command="{Binding LoadRacesCommand}"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBool}}" />    
                        <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" />                      
                        <Grid RowDefinitions="Auto,Auto" RowSpacing="8">
                        <Grid Grid.Row="0" ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <Label Grid.Column="0" Text="Country:" VerticalOptions="Center" Padding="0,0,12,0" />
                            <Picker Grid.Column="1"
                                    Title=""
                                    ItemsSource="{Binding CountryFilterOptions}"
                                    SelectedItem="{Binding CountryFilter, Mode=TwoWay}"
                                    VerticalOptions="Center"
                                    HorizontalOptions="Fill" />
                        </Grid>
                        <Grid Grid.Row="1" ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Picker x:Name="RacePicker"
                                    Grid.Column="0"
                                    Title="Select race"
                                    ItemsSource="{Binding FilteredRaces}"
                                    ItemDisplayBinding="{Binding DisplayName}"
                                    SelectedItem="{Binding SelectedRaceOption, Mode=TwoWay}"
                                    HorizontalOptions="Fill" />
                            <!--HorizontalStackLayout Grid.Column="1" Spacing="8">
                                <Button Text="Load Races"
                                        Command="{Binding LoadRacesCommand}"
                                        IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBool}}" />
                                <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" />
                            </HorizontalStackLayout-->
                        </Grid>
                    </Grid>
                    <Button Text="Refresh Value Bets"
                            Command="{Binding RefreshValueBetsCommand}"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBool}}"
                            BackgroundColor="{StaticResource Primary}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Status -->
            <Label Text="{Binding StatusMessage}"
                   LineBreakMode="WordWrap"
                   TextColor="{StaticResource Gray600}"
                   FontSize="14" />

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
